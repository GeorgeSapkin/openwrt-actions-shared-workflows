name: Test Formalities

on:
  workflow_call:
    inputs:
      exclude_dependabot:
        description: 'Exclude commits authored by dependabot from some checks'
        default: true
        required: false
        type: boolean
      exclude_weblate:
        description: 'Exclude commits authored by Weblate from some checks'
        required: false
        type: boolean
      post_comment:
        description: 'Post summaries to the pull request'
        required: false
        type: boolean
      warn_on_no_modify:
        description: 'Warn when PR edits by maintainers are not allowed. Requires post_comment to be true.'
        required: false
        type: boolean

permissions:
  pull-requests: write

jobs:
  formalities:
    name: Test Formalities
    runs-on: ubuntu-slim

    steps:
      - name: Test Formalities
        uses: georgesapkin/hyperstickler@v1-beta.3
        with:
          check_signoff: true
          exclude_dependabot: ${{ inputs.exclude_dependabot }}
          exclude_weblate: ${{ inputs.exclude_weblate }}
          feedback_url: 'https://github.com/openwrt/actions-shared-workflows/issues'
          guideline_url: 'https://openwrt.org/submitting-patches#submission_guidelines'
          max_body_line_len: 75
          max_subject_len_hard: 60
          max_subject_len_soft: 50
          post_comment: ${{ inputs.post_comment }}
          warn_on_no_modify: ${{ inputs.warn_on_no_modify }}
